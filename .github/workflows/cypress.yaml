name: Cypress Tests

on:
  push:
    branches: [main]

jobs:
  cypress-run:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout code
      - name: Checkout
        uses: actions/checkout@v4

      # 2. Setup PNPM 10
      - name: Setup PNPM
        uses: pnpm/action-setup@v4
        with:
          version: 10

      # 3. Setup Node 24
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 24
          cache: "pnpm"

      # 4. Run Cypress tests
      - name: Run Cypress tests
        uses: cypress-io/github-action@v6
        with:
          install-command: pnpm install
          browser: electron
        env:
          CYPRESS_baseUrl: ${{ secrets.BASE_URL }}
          VIEWPORT_WIDTH: ${{ secrets.VIEWPORT_WIDTH }}
          VIEWPORT_HEIGHT: ${{ secrets.VIEWPORT_HEIGHT }}
          CYPRESS_VIDEO: ${{ secrets.CYPRESS_VIDEO }}

      # 5. Upload Videos Artifact
      - name: Upload Videos
        # "always()" ensures videos upload even if tests fail
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: cypress-videos
          path: cypress/videos
